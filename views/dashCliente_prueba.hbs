

{{!-- /////  Comienza el milton que viene de NH --}}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

{{!--
****************************************************************************
*                             Tabulator Library                            *
****************************************************************************
 --}}

{{!-- <link href="dist/css/tabulator_modern.css" rel="stylesheet"> --}}
<link href="dist/css/tabulator.min.css" rel="stylesheet">
<script type="text/javascript" src="dist/js/tabulator.min.js"></script>

{{!--
****************************************************************************
*                                    CSS                                   *
****************************************************************************
 --}}

<style>
.button {
  background-color: #4CAF50;
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
}
</style>

{{!--
****************************************************************************
*                           Funciones para tabla                           *
****************************************************************************
--}}

<script type="text/javascript">

const PARABOLA_SIN_RADOME      = "Parabólica sin radome"
const PARABOLA_ESCUDO_PLANO    = "Parabólica con escudo plano";
const PARABOLA_CON_RADOME = "Parabólica con radome"
const PARABOLA_GRILLADA  = "Parabólica grillada"
const RRU                  = "RRU"
const SECTORIAL            = "Sectorial"
const OMNIDIRECCIONAL      = "Omnidireccional"

const NULL_DATA = "***"

const LISTA_ANTENAS_DIAMETRO =
  [PARABOLA_SIN_RADOME, PARABOLA_ESCUDO_PLANO, PARABOLA_CON_RADOME, PARABOLA_GRILLADA];
const LISTA_ANTENAS_LARGO_ANCHO =
  [RRU, SECTORIAL, OMNIDIRECCIONAL];

function clearTable() {
// Limpiar Tabla

  table.clearData();
};

function addRow() {
// Agregar fila
  table.addRow();
};


function postData(path, method) {
// Funcion que publica los datos escritos en la tabla.
// Es llamada por el botón *Enviar*.
var data_array = table.getData(); 
var getnorma = document.getElementById("norma");

var getviento = document.getElementById("viento");
var getnorma = document.getElementById("norma");
var getid = document.getElementById("idMC");
var getalturatorre = document.getElementById("alturaTorre");
var getcodigo = document.getElementById("codigo");
var getfu = document.getElementById("fu");
var gethielo = document.getElementById("hielo");
var getfecha = document.getElementById("fecha");
var getlugar = document.getElementById("lugar");
var getMomento = document.getElementById("momento");
var getCorte = document.getElementById("corte");
var getcondicion_viento = document.getElementById("condicion_viento");  
var gettipo = document.getElementById("tipo");
var token = localStorage.getItem("token");


var adicional=data_array.push({
  norma:getnorma.value,
  viento:getviento.value,
  idMC:getid.value,
  alturaTorre:getalturatorre.value,
  codigo:getcodigo.value,
  fu:getfu.value,
  fecha:getfecha.value,
  hielo:gethielo.value,
  lugar:getlugar.value,
  momento:getMomento.value,
  corte:getCorte.value,
  tipo:gettipo.value,
  token:token.value,
  });


var enviar =JSON.stringify(data_array);

method =  "post";
var path=path;
var form = document.createElement("form");
form.setAttribute("method", method);
form.setAttribute("action", path);
            var hiddenField = document.createElement("input");
            hiddenField.setAttribute("type", "hidden");
            hiddenField.setAttribute("name", "armando");
            hiddenField.setAttribute("value", enviar);
            form.appendChild(hiddenField);

     document.body.appendChild(form);
    form.submit();
}



  function post(path, params, method) {

    method = method || "post"; // Set method to post by default if not specified.

    // The rest of this code assumes you are not using a library.
    // It can be made less wordy if you use one.
    var form = document.createElement("form");
    form.setAttribute("method", method);
    form.setAttribute("action", path);

    for(var key in params) {
        if(params.hasOwnProperty(key)) {
            var hiddenField = document.createElement("input");
            hiddenField.setAttribute("type", "hidden");
            hiddenField.setAttribute("name", key);
            hiddenField.setAttribute("value", params[key]);
            form.appendChild(hiddenField);
        }
    }

    document.body.appendChild(form);
    form.submit();

}



var cell = null;

function cellClick(cell_event) {
// Funcion que mantiene las celdas disponibles según el tipo de antena.
// Ej: Antenas sectoriales necesitan largo y ancho pero no diámetro.

  console.log("Antena seleccionada");
  var row = cell_event.getRow();
  var cell = row.getCell("antena");
  var value = cell.getValue();

  if (LISTA_ANTENAS_DIAMETRO.includes(value)) {

    console.log("Antena tiene diametro...")
    var cell_largo = row.getCell("largo");
    cell_largo.setValue(NULL_DATA, null);

    cell_ancho = row.getCell("ancho");
    cell_ancho.setValue(NULL_DATA, null);

    cell = cell_ancho;
  }

  else {

    console.log("Antena tiene largo y ancho...")
    var cell_diametro = row.getCell("diametro");
    cell_diametro.setValue(NULL_DATA, null);
  }
};

</script>

{{!--
****************************************************************************
*                                   BODY                                   *
****************************************************************************
 --}}

{{> head }}
{{!-- <body onload="cargar_pagina()"> --}}
{{> navbarclient }}
<div class="container-fluid">
  <p class="lead">Hola {{nombre}} </p>
</div>

<div class="jumbotron">
        <h1 class="display-4">Ingreso de antenas</h1>
            <h2 class="display-4" align ='right'> {{> version }}</h2>

<ul class="navbar-nav mr-auto">
          <p class="lead">Datos sobre la memoria de cálculo base </p>
            
  <div>          
 <table border="1">
 {{#each band.nombre1}}
            <tr>
    <td><strong>Estudio </strong>    </td><td>{{general.codigo}}</td>
  </tr>
  <tr>
    <td><strong>Realizado </strong>    </td><td>{{general.fecha}}</td>
  </tr>
  <tr>
    <td><strong>Bajo la norma</strong>     </td><td>{{general.norma}}</td>
  </tr>
    <tr>
    <td><strong>Condición del  viento</strong>     </td><td>{{general.viento}}</td>
  </tr>
   <tr>
    <td><strong>Factor utilizacion (%) </strong>     </td><td>{{general.fu}}</td>
  </tr>
  {{/each}}
</table>
</div> 
<p></p>
<p class="lead">Equipamento existente</p>  

         <table border="1">   
    <tr>
    <td><strong>Tipo</strong></td><td><strong>Orientación</strong></td><td><strong>Altura</strong></td><td><strong>cantidad</strong></td>
  </tr>
{{#each band.nombre2}}      
  <tr>  
     <td>{{antena.descripcion}} </td><td>{{antena.orientacion}}</td> <td>{{antena.alto}}</td> <td>{{antena.cantidad}}</td>
  </tr>   
{{/each}}
</table>

{{!--
****************************************************************************
*                          Acá se inserta la tabla                         *
****************************************************************************
--}}
<p></p>
<p></p>
<p></p>
<p class="lead">Carga a adicionar </p>
<div>

    <div id="example-table"></div>

{{!-- Botones --}}

  <form action="/resultadoAS_pruebas" method="POST"></form>
  <button class="button" type="button" onclick="clearTable()">Borrar todo</button>
  <button class="button" type="button" onclick="addRow()"    >Añadir equipo</button>
  <button class="button" type="button" onclick="postData('/resultadoAS_pruebas')"  >CALCULAR</button>
</form>


<br><br>

{{!-- Tabla --}}


</div>
{{!--
****************************************************************************
*                         Carga de datos iniciales                         *
****************************************************************************
 --}}

<script type="text/javascript">
// Ejemplo de carga de datos iniciales
var tableData = [
    {antena:   SECTORIAL,
     cantidad: "2",
     altura:   "42",
     largo:    "0.200",
     ancho:    "0.170",
     diametro: NULL_DATA
     },

    {antena:   PARABOLA_ESCUDO_PLANO,
     cantidad: "3",
     altura:   "36",
     largo:    NULL_DATA,
     ancho:    NULL_DATA,
     diametro: "1.2"
     },
]

var table = new Tabulator("#example-table", {
  cellEdited : function(cell) {cellClick(cell)},
  data:             tableData,    // ** set initial table data  **
  layout:           "fitColumns", // fit columns to width of table
  responsiveLayout: "hide",       // hide columns that dont fit on the table
  tooltips:         true,         // show tool tips on cells
  addRowPos:        "bottom",     // when adding a new row, add it to the top of the table
  history:          true,         // allow undo and redo actions on the table
  // pagination:"local",          // paginate the data
  paginationSize:   200,          // allow 200 rows per page of data (NHs)
  movableColumns:   true,         // allow column order to be changed
  resizableRows:    true,         // allow row order to be changed
  // initialSort:[                // set the initial sort order of the data
  //   {column:"rownum", dir:"asc"},
  // ],
  columns:[                 //define the table columns
    {title: "Id", formatter:"rownum", align:"center", width:40},
    {title:"Tipo de Antena", field:"antena",validator:"required"  , editor:"select",
      editorParams:{ "Parabólica sin radome"    : PARABOLA_SIN_RADOME,
                    "Parabólica con escudo plano" : PARABOLA_ESCUDO_PLANO,
                    "Parabólica con radome"   : PARABOLA_CON_RADOME,
                    "Parábolica grillada"     : PARABOLA_GRILLADA,
                    "RRU"               : RRU,
                    "Sectorial"         : SECTORIAL,
                    "Omnidireccional"   : OMNIDIRECCIONAL
                    },
    },
    {title:"Cantidad",     field:"cantidad", editor:"input",validator:"numeric"},
    {title:"Altura [m]",   field:"altura",   editor:"input",validator:"numeric"},
    {title:"Largo [m]",    field:"largo",    editor:"input",validator:"numeric"},
    {title:"Ancho [m]",    field:"ancho",    editor:"input",validator:"numeric"},
    {title:"Diámetro [m]", field:"diametro", editor:"input",validator:"numeric"},
  ],
});
</script>

{{!-- ---------------------------------------------------------------- --}}


<input id="tokentxt" name="token" type="hidden" value="{{token}}"> <br>
</div>
    <div >
        <form action="/../resultadoAS" method="POST" id="prueba">            
             
                            <div class="input-group">
                               {{#each band.nombre1}}

                              <input type="hidden" id="viento" name="viento" value={{general.viento}}>                               
                              <input type="hidden" id="norma"  name="norma" value={{general.norma}}>
                              <input type="hidden" id="idMC"  name="id_hist_mc" value={{general.id_hist_mc}}>
                              <input type="hidden" id="alturaTorre"  name="altura_torre" value={{general.altura_torre}}>
                              <input type="hidden" id="codigo"  name="codigo" value={{general.codigo}}> 
                              <input type="hidden" id="fu"  name="fu" value={{general.fu}}>  
                              <input type="hidden" id="hielo"  name="hielo" value={{general.hielo}}> 
                              <input type="hidden" id="fecha" name="fecha" value={{general.fecha}}>
                              <input type="hidden" id="lugar" name="lugar" value={{general.nombreSitio}}>
                              <input type="hidden" id="momento" name="momento" value={{general.momento_basal}}>
                              <input type="hidden" id="corte" name="corte" value={{general.corte_basal}}>    
                              <input type="hidden" id="tipo" name="tipo" value={{general.tipo}}>
                              

                             
                              
                              <input type="hidden" id="condicion_viento" name="condicion_viento" value={{general.viento}}>

                                                       {{!-- ///serializar la salida para que la pueda mandar  el html --}}
                              
                              {{/each}}

                 
                            </div>
       
               
        

        </form>




    </div>

{{!-- /*//////////////División de sección/////////////////*/ --}}
<hr class="my-4"> 

{{> footer}}